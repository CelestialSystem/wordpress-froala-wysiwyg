/*!
 * froala_editor v3.2.3 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2020 Froala Labs
 */

!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],a):a(e.FroalaEditor)}(this,function(S){"use strict";S=S&&S.hasOwnProperty("default")?S["default"]:S,Object.assign(S.DEFAULTS,{trackChangesEnabled:!1,showChangesEnabled:!1}),S.PLUGINS.track_changes=function(p){var C=p.$,i=[],e=p.$tb.find('> .fr-more-toolbar[data-name="trackChanges-'+p.id+'"]');if(!e.length){e=C('<div class="fr-more-toolbar"></div>').data("name","trackChanges-".concat(p.id));var a=C(p.button.build("showChanges",S.COMMANDS.showChanges,!0)),t=C(p.button.build("applyAll",S.COMMANDS.applyAll,!0)),n=C(p.button.build("removeAll",S.COMMANDS.removeAll,!0)),r=C(p.button.build("applyLast",S.COMMANDS.applyLast,!0)),s=C(p.button.build("removeLast",S.COMMANDS.removeLast,!0));e.append(a),e.append(t),e.append(n),e.append(r),e.append(s),p.$tb.append(e),p.button.addButtons(a),p.button.addButtons(t),p.button.addButtons(n),p.button.addButtons(r),p.button.addButtons(s)}function l(){return i.pop()}function c(e){var a=!(!e||8!=e.keyCode);if(p.opts.trackChangesEnabled){p.selection.restore();var t=p.selection.ranges(0).startContainer;if(!C(t).parentsUntil(p.$el,"[data-tracking=true]").length)if(p.selection.isCollapsed()){p.markers.insert();var n=p.$el.find(".fr-marker"),r="pending-".concat(p.id,"-").concat(p.track_changes.getPendingChanges().length),i=p.opts.showChangesEnabled?'class="fr-highlight-change"':"";if(a){var s=n[0].previousSibling?n[0].previousSibling.nodeValue:" ",l=s.slice(0,-1),o=(n[0].previousSibling,C('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,"></span>"))),c=C('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');C(n).before(o),o.prepend(c);var g=s.replace(l,"");c.append(g),n[0].previousSibling.nodeValue=l}else n.replaceWith('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,">").concat(S.INVISIBLE_SPACE+S.MARKERS,"</span>"));p.selection.restore(),p.track_changes.pushChange(r)}else{p.selection.save(),f(p.$el.find('.fr-marker[data-type="true"]').length&&p.$el.find('.fr-marker[data-type="true"]').get(0),p.$el.find('.fr-marker[data-type="false"]').length&&p.$el.find('.fr-marker[data-type="false"]').get(0)),p.selection.restore()}}}function f(e,a){if(e){for(;e.nodeType===Node.COMMENT_NODE;)e=e.nextSibling;if(p.node.isBlock(e)&&"HR"!==e.tagName)return p.node.hasClass(e.firstChild,"fr-marker")?f(e.firstChild.nextSibling,a):f(e.firstChild,a),!1;var t="pending-".concat(p.id,"-").concat(p.track_changes.getPendingChanges().length),n=p.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=C('<span data-tracking="true" data-track-id="'.concat(t,'" ').concat(n,"></span>")),i=C('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>'),s=e;for(C(e).before(r),p.track_changes.pushChange(t);s&&C(s).hasClass("fr-marker");)s=s.nextSibling;for(var l=!1;s&&!l&&!C(s).hasClass("fr-marker")&&0===C(s).find("fr-marker").length&&"UL"!==s.tagName&&"OL"!==s.tagName;){var o=s;if(p.node.isBlock(s)&&"HR"!==e.tagName)return f(s.firstChild,a),!1;if(s)for(var c=s.childNodes,g=0;g<c.length;g++)if(c[g].className&&"fr-marker"===c[g].className){l=!0,f(s.firstChild,a);break}l||(s=s.nextSibling,i.append(o))}if(r.prepend(i),r.prepend("".concat(S.INVISIBLE_SPACE+S.MARKERS)),r.append("".concat(S.INVISIBLE_SPACE+S.MARKERS)),!s&&!e.isSameNode(a)){for(var h=r.get(0).parentNode;h&&!h.nextSibling&&!p.node.isElement(h);)h=h.parentNode;if(h){var d=h.nextSibling;d&&(p.node.isBlock(d)?"HR"===d.tagName?f(d.nextSibling,a):f(d.firstChild,a):f(d,a))}}}}return p.events.on("keydown",function(e){(function a(e){return(!p.keys.ctrlKey(e)||e.which!==S.KEYCODE.Z&&e.which!==S.KEYCODE.C)&&(48<=e.keyCode&&e.keyCode<=57||65<=e.keyCode&&e.keyCode<=90||186<=e.keyCode&&e.keyCode<=222||13===e.keyCode||8===e.keyCode||32===e.keyCode||46===e.keyCode||96<=e.keyCode&&e.keyCode<=111)})(e)&&c(e)},!0),p.events.on("commands.before",function(a){if(["change","applyLast","removeLast","showChanges","trackChanges","moreTrackChanges","undo","redo"].filter(function(e){return e===a})||["applytextColor","bold","italic","underline","strikeThrough","subscript","superscript","fontFamily","fontSize","textColor","backgroundColor","inlineClass","inlineStyle","clearFormatting","alignLeft","alignCenter","formatOLSimple","alignRight","alignJustify","formatOL","formatUL","paragraphFormat","paragraphStyle","lineHeight","outdent","indent","quote"].filter(function(e){return e===a}))!function o(){if(p.opts.trackChangesEnabled){p.selection.restore();var e=p.selection.ranges(0),a=e.startContainer,t=C(a).parentsUntil(p.$el,"[data-tracking=true]");if(!t.length&&!p.selection.isCollapsed()){p.selection.save();var n=p.$el.find('.fr-marker[data-type="true"]').length&&p.$el.find('.fr-marker[data-type="true"]').get(0),r=p.$el.find('.fr-marker[data-type="false"]').length&&p.$el.find('.fr-marker[data-type="false"]').get(0);!function f(e,a){if(!e)return;for(;e.nodeType===Node.COMMENT_NODE;)e=e.nextSibling;if(p.node.isBlock(e)&&"HR"!==e.tagName)return p.node.hasClass(e.firstChild,"fr-marker")?f(e.firstChild.nextSibling,a):f(e.firstChild,a),!1;var t="pending-".concat(p.id,"-").concat(p.track_changes.getPendingChanges().length);var n=p.opts.showChangesEnabled?'class="fr-highlight-change"':"";var r=C('<span data-tracking="true" data-track-id="'.concat(t,'" ').concat(n,"></span>"));var i=C('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false" style="display:none"></span>');var s=e;C(e).before(r);p.track_changes.pushChange(t);for(;s&&C(s).hasClass("fr-marker");)s=s.nextSibling;var l=!1;for(;s&&!l&&!C(s).hasClass("fr-marker")&&0===C(s).find("fr-marker").length&&"UL"!==s.tagName&&"OL"!==s.tagName;){var o=s;if(p.node.isBlock(s)&&"HR"!==e.tagName)return f(s.firstChild,a),!1;if(s)for(var c=s.childNodes,g=0;g<c.length;g++)if(c[g].className&&"fr-marker"===c[g].className){l=!0,f(s.firstChild,a);break}l||(s=s.nextSibling,i.append(o.cloneNode(!0)),r.append(o))}C(s).hasClass("fr-marker")&&r.append(s);r.prepend(i);r.prepend("".concat(S.INVISIBLE_SPACE));r.append("".concat(S.INVISIBLE_SPACE));if(!s&&!e.isSameNode(a)){for(var h=r.get(0).parentNode;h&&!h.nextSibling&&!p.node.isElement(h);)h=h.parentNode;if(h){var d=h.nextSibling;d&&(p.node.isBlock(d)?"HR"===d.tagName?f(d.nextSibling,a):f(d.firstChild,a):f(d,a))}}}(n,r);for(var i=p.$el.find('.fr-marker[data-type="true"]').length&&p.$el.find('.fr-marker[data-type="true"]').get(0),s=i.previousSibling,l=s.firstChild;l&&"SPAN"!==l.tagName;)l=l.nextSibling;l.after(i),p.selection.restore()}}}();else{if(S.COMMANDS[a]&&(S.COMMANDS[a].hasOwnProperty("type")&&"dropdown"===S.COMMANDS[a].type||S.COMMANDS[a].more_btn||S.COMMANDS[a].popup))return;c()}},!0),p.events.on("commands.after",function(e){0<=["undo","redo"].indexOf(e)&&function n(){var e=p.$el.find("[data-tracking=true]");i.splice(0,i.length);for(var a=0;a<e.length;a++){var t=C(e.get(a)).data("track-id");i[t.slice(t.lastIndexOf("-")+1)]=t}}()},!0),{toggleTracking:function o(){p.opts.trackChangesEnabled&&-1<p.html.get(!0,!0).indexOf("data-tracking")?alert("Your editor has pending changes. Please resolve them before turning off Track Changes in the toolbar."):(p.commands.moreTrackChanges(),p.opts.trackChangesEnabled=!p.opts.trackChangesEnabled)},pushChange:function g(e){i.push(e)},popChange:l,getPendingChanges:function h(){return i},showChanges:function d(){if(p.opts.showChangesEnabled=!p.opts.showChangesEnabled,p.opts.showChangesEnabled)for(var e=p.$el.find("[data-tracking=true]").not(".fr-highlight-change"),a=0;a<e.length;a++)C(e.get(a)).addClass("fr-highlight-change");else for(var t=p.$el.find(".fr-highlight-change"),n=0;n<t.length;n++)C(t.get(n)).removeClass("fr-highlight-change")},acceptAllChanges:function u(){for(var e=0;e<i.length;e++){var a=p.$el.find("[data-track-id=".concat(i[e],"]"));if(a.length)for(var t=0;t<a.length;t++){var n=a.get(t),r=C(n).find("[data-tracking-deleted=true]");r.length&&r.get(0).remove(),n.hasAttribute("style")?(C(n).removeData("tracking"),C(n).removeData("track-id"),C(n).removeClass("fr-highlight-change")):(p.selection.save(),n.outerHTML=n.innerHTML)}}i=[]},rejectAllChanges:function k(){for(var e=p.$el.find("[data-tracking=true]"),a=0;a<e.length;a++){var t=C(e.get(a)).find("[data-tracking-deleted=true]");t.length?e.get(a).outerHTML=t.get(0).innerHTML:e.get(a).remove()}i=[]},acceptSingleChange:function m(){var e=l();if(e){var a=p.$el.find("[data-track-id=".concat(e,"]"));if(a.length)for(var t=0;t<a.length;t++){var n=a.get(t),r=C(n).find("[data-tracking-deleted=true]");r.length&&r.get(0).remove(),n.hasAttribute("style")?(C(n).removeData("tracking"),C(n).removeData("track-id"),C(n).removeClass("fr-highlight-change")):(p.selection.save(),n.outerHTML=n.innerHTML)}}},rejectSingleChange:function b(){var e=l();if(e){var a=p.$el.find("[data-track-id=".concat(e,"]"));if(a.length)for(var t=0;t<a.length;t++){var n=C(a.get(t)).find("[data-tracking-deleted=true]");n.length?a.get(t).outerHTML=n.get(0).innerHTML:a.get(t).remove()}}},refresh:function v(e){e.toggleClass("fr-disabled",!i.length),e.toggleClass("fr-active",i.length).attr("aria-pressed",i.length)},removeSpecialItem:function y(e){p.selection.setBefore(e.get(0)),p.selection.setAfter(e.get(0)),f(p.$el.find('.fr-marker[data-type="true"]').length&&p.$el.find('.fr-marker[data-type="true"]').get(0),p.$el.find('.fr-marker[data-type="false"]').length&&p.$el.find('.fr-marker[data-type="false"]').get(0))}}},S.DefineIcon("trackChanges",{NAME:"enable-tracking",SVG_KEY:"trackChanges"}),S.DefineIcon("showChanges",{NAME:"show-changes",SVG_KEY:"showTrackChanges"}),S.DefineIcon("applyAll",{NAME:"apply-all",SVG_KEY:"acceptAllChanges"}),S.DefineIcon("removeAll",{NAME:"remove-all",SVG_KEY:"rejectAllChanges"}),S.DefineIcon("applyLast",{NAME:"apply-last",SVG_KEY:"acceptSingleChange"}),S.DefineIcon("removeLast",{NAME:"remove-last",SVG_KEY:"rejectSingleChange"}),S.RegisterCommand("trackChanges",{type:"button",title:"Enable Track Changes",plugin:"track_changes",callback:function(){this.track_changes.toggleTracking()},refreshAfterCallback:!0,forcedRefresh:!0,refresh:function(e){e.toggleClass("fr-active",this.opts.trackChangesEnabled).attr("aria-pressed",this.opts.trackChangesEnabled)}}),S.RegisterCommand("showChanges",{type:"button",icon:"showChanges",title:"Show Changes",plugin:"track_changes",undo:!1,focus:!1,accessibilityFocus:!0,forcedRefresh:!0,refreshAfterCallback:!0,toggle:!0,callback:function(){this.track_changes.showChanges()},refresh:function(e){e.toggleClass("fr-active",this.opts.showChangesEnabled).attr("aria-pressed",this.opts.showChangesEnabled)}}),S.RegisterCommand("applyAll",{type:"button",icon:"applyAll",title:"Accept All Changes",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.acceptAllChanges()},refresh:function(e){this.track_changes.refresh(e)}}),S.RegisterCommand("removeAll",{type:"button",icon:"removeAll",title:"Reject All Changes",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.rejectAllChanges()},refresh:function(e){this.track_changes.refresh(e)}}),S.RegisterCommand("applyLast",{type:"button",icon:"applyLast",title:"Accept Single Change",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.acceptSingleChange()},refresh:function(e){this.track_changes.refresh(e)}}),S.RegisterCommand("removeLast",{type:"button",icon:"removeLast",title:"Reject Single Change",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.rejectSingleChange()},refresh:function(e){this.track_changes.refresh(e)}})});